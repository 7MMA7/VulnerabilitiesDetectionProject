# VulPrune: A Hybrid Multi-Agent Architecture for Reliable Automated Vulnerability Detection

## Project Structure

```
├── compare_reports.py
├── ComputeMetrics.ipynb
├── cppcheck
│   ├── anonymise_cppcheck.py
│   ├── apply_cppcheck.py
│   ├── raw_cppcheck
│   ├── reduce_cppcheck_reports.py
│   └── reports
│       ├── [idx]_report.txt
│       └── ...
├── cwe_example
│   ├── cwe_commit_diff_examples.json
│   ├── cwe_commit_diff_vuln_examples.json
│   ├── extract_llm_cwe_example.ipynb
│   └── filtered_cvelistV5_by_primevul_cwe.jsonl
├── extracted_vulnerabilities
│   ├── extract_pairs.py
│   └── pair_[idx]_[idx]
│       ├── fixed_flawfinder.txt
│       ├── fixed_report.txt
│       ├── metadata.json
│       ├── [changed_file_fixed]
│       ├── [changed_file_vuln]
│       ├── vuln_flawfinder.txt
│       └── vuln_report.txt
├── flawfinder
│   ├── anonymise_flawfinder.py
│   ├── apply_flawfinder.py
│   ├── raw_flawfinder
│   ├── reduce_flawfinder_reports.py
│   └── reports
│       ├── [idx]_report.txt
│       └── ...
├── preprocess_dataset
│   ├── add_meta_data.py
│   └── purge_pairs.py
├── PrimeVul
│   ├── primevul_filtered.jsonl
│   ├── primevul_test_paired_enriched.jsonl
│   └── primevul_test_paired.jsonl
├── README.md
├── scan_extracted_vulnerabilities.py
├── sonarqube
│   ├── chunks
|   ├── .github
│   │   └── workflows
│   │       └── vuln_scan.yml
│   ├── reports
│   |   ├── analysis-results_[pair_number]
│   |   │   ├── filtered_results.jsonl
│   |   │   └── final_results.json
│   |   └── ...
|   └── scripts
│      ├── output_format.py
│      └── scan_sonarcloud.py
└── VulPrune.ipynb
```

## Description

The main components of the project are `VulPrune.ipynb` and `ComputeMetrics.ipynb`:

- `VulPrune.ipynb`: Implements the VulPrune multi-agent architecture for automated vulnerability detection.  
- `ComputeMetrics.ipynb`: Computes performance metrics based on the detection results.

## Configuration

### VulPrune.ipynb
Set the following API keys to enable the language models and code search functionality:  
- `OPENAI_API_KEY` — OpenAI API key for language models.  
- `GROQ_API_KEY` — Groq API key for Groq models.  
- `DEEPSEEK_API_KEY` — DeepSeek API key for code search.

### ComputeMetrics.ipynb
Set the path to the JSON results generated by `VulPrune.ipynb`:  
- `json_file`

## Quick Note on SonarQube Analysis

To generate chunks for analysis:
```bash
split -l 2 -d -a 3 --additional-suffix=.jsonl primevul_filtered.jsonl chunk_
```

The current repository provides scripts to gather the necessary files for SonarQube analysis. To actually run the analysis, you will need:
1. A SonarCloud account.
2. A SonarCloud project set up.
3. A token and secrets configured in your repository.

You may need to modify the scripts to fully integrate the analysis workflow with your SonarCloud project.